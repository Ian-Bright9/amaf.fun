<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create AMAF Metadata</title>
  <style>
    body {
      font-family: monospace;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #1a1a2a;
      color: #f0f0f0;
    }
    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: #2a2a2a;
      border-radius: 8px;
    }
    h2 {
      margin-top: 0;
      color: #a9e34b;
    }
    code {
      background: #1a1a2a;
      padding: 15px;
      border-radius: 5px;
      display: block;
      overflow-x: auto;
      white-space: pre-wrap;
      color: #a9e34b;
    }
    .success {
      color: #4ade80;
    }
    .info {
      color: #7dd3fc;
    }
    .warning {
      color: #f59e0b;
    }
    button {
      background: #4ade80;
      color: #1a1a2a;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      margin: 10px 0;
    }
    button:hover {
      background: #6b8f23;
    }
    #step2-code {
      font-size: 12px;
    }
    .copy-btn {
      background: #7dd3fc;
      color: #1a1a2a;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      background: #4ade80;
      border-radius: 8px;
    }
    .hidden {
      display: none;
    }
  </style>
  <script type="importmap">
    {
      "imports": {
        "@solana/web3.js": "https://esm.sh/@solana/web3.js@1.95.8",
        "@metaplex-foundation/js": "https://esm.sh/@metaplex-foundation/js@0.20.1"
      }
    }
  </script>
</head>
<body>
  <div class="section">
    <h2>üéØ AMAF Coin Metadata Creation</h2>
    <p>Follow these 3 steps to create metadata for your AMAF Coin on devnet.</p>
  </div>

  <div class="section">
    <h2>üìç Step 1: Set Mint Authority to Your Wallet</h2>
    <p class="info">This transfers mint authority from the program PDA to your wallet.</p>
    <p class="warning">‚ö†Ô∏è  This step must be done FIRST before creating metadata!</p>
    <p>Run this in your terminal:</p>
    <code>docker compose run --rm anchor anchor invoke set_mint_authority Cu6m9sKWsN6q6dVW6N1L271yn3iqe61HBHpA85kivqhg --program-id Gh8YHDTXiRY8ZA3zkxSsrUb1az7Vxc4z9SH9U6LvoMW</code>
    <p>Expected output:</p>
    <p class="success">‚úì Mint authority transferred to your wallet</p>
  </div>

  <div class="section">
    <h2>üìç Step 2: Create Metadata with Metaplex</h2>
    <p class="info">This creates the Metaplex metadata account using your wallet as the mint authority.</p>
    <p class="warning">‚ö†Ô∏è  Make sure Step 1 completed first!</p>
    <p class="info">üìù Before running: Copy your keypair file content (should be a JSON array like [1,2,3...]) to clipboard</p>
    <p>Run this code in your browser console (F12) to create metadata:</p>
    <code id="step2-code">
const { Connection, Keypair, PublicKey } = await import("@solana/web3.js");
const { Metaplex, keypairIdentity } = await import("@metaplex-foundation/js");
const connection = new Connection("https://api.devnet.solana.com");

const clipboardText = await navigator.clipboard.readText();
console.log("Clipboard content (first 100 chars):", clipboardText.substring(0, 100));
const keypair = Keypair.fromSecretKey(new Uint8Array(JSON.parse(clipboardText)));

const mintPDA = "6SZG9fnQ3PUj8C41ootubxdzhdhb8hWv9zMRE97U1GWG";
const metaplex = Metaplex.make(connection);
metaplex.use(keypairIdentity(keypair));

const result = await metaplex.nfts().create({
  uri: "https://raw.githubusercontent.com/Ian-Bright9/amaf.fun/main/public/amafcoin-metadata.json",
  name: "AMAF Coin",
  symbol: "AMAF",
  sellerFeeBasisPoints: 0,
  isMutable: true,
  useExistingMint: new PublicKey(mintPDA),
  tokenStandard: 'Fungible',
});

const metadataAddress = result.nft.metadataAddress.toString();
console.log("‚úÖ Metadata created at:", metadataAddress);
    </code>
    <button class="copy-btn" onclick="copyCode()">üìã Copy Code</button>
    <button onclick="runCode()">‚ñ∂Ô∏è  Run Code</button>
  </div>

  <div class="section">
    <h2>üìç Step 3: Restore Mint Authority to PDA</h2>
    <p class="info">This transfers mint authority back to the program PDA.</p>
    <p>Run this in your terminal after completing Step 2:</p>
    <code>docker compose run --rm anchor anchor invoke set_mint_authority null --program-id Gh8YHDTXiRY8ZA3zkxSsrUb1az7Vxc4z9SH9U6LvoMW</code>
    <p>Expected output:</p>
    <p class="success">‚ú® Mint authority restored to PDA</p>
  </div>

  <div class="section">
    <h2>üéâ Verification</h2>
    <p>After completing all 3 steps, verify your metadata at:</p>
    <code>https://explorer.solana.com/address/&lt;METADATA_ADDRESS&gt;?cluster=devnet</code>
    <p class="info">Replace &lt;METADATA_ADDRESS&gt; with the actual metadata address printed in Step 2.</p>
  </div>

  <div class="section" id="result" style="display: none;">
    <h2 class="success">‚ú® Success!</h2>
    <p>Your AMAF Coin now has full metadata on devnet!</p>
    <p>Metadata address: <span id="metadata-result"></span></p>
  </div>

  <script>
    async function copyCode() {
      const code = document.getElementById('step2-code').innerText;
      await navigator.clipboard.writeText(code);
      alert('Code copied! Now run it in your browser console (F12)');
    }

    async function runCode() {
      try {
        const clipboardText = await navigator.clipboard.readText();
        console.log("Clipboard content (first 100 chars):", clipboardText.substring(0, 100));

        if (!clipboardText.trim()) {
          throw new Error('Clipboard is empty. Please copy your keypair file content first.');
        }

        if (!clipboardText.startsWith('[') || !clipboardText.endsWith(']')) {
          throw new Error('Clipboard content is not a valid JSON array. Expected format: [1,2,3,...]');
        }

        const { Connection, Keypair, PublicKey } = await import("@solana/web3.js");
        const { Metaplex, keypairIdentity } = await import("@metaplex-foundation/js");
        const connection = new Connection("https://api.devnet.solana.com");
        const keypair = Keypair.fromSecretKey(new Uint8Array(JSON.parse(clipboardText)));
        const mintPDA = "6SZG9fnQ3PUj8C41ootubxdzhdhb8hWv9zMRE97U1GWG";
        const metaplex = Metaplex.make(connection);
        metaplex.use(keypairIdentity(keypair));

        const result = await metaplex.nfts().create({
          uri: "https://raw.githubusercontent.com/Ian-Bright9/amaf.fun/main/public/amafcoin-metadata.json",
          name: "AMAF Coin",
          symbol: "AMAF",
          sellerFeeBasisPoints: 0,
          isMutable: true,
          useExistingMint: new PublicKey(mintPDA),
          tokenStandard: 'Fungible',
        });

        const metadataAddress = result.nft.metadataAddress.toString();

        document.getElementById('result').classList.remove('hidden');
        document.getElementById('metadata-result').textContent = metadataAddress;
      } catch (error) {
        alert('Error: ' + error.message);
        console.error(error);
      }
    }
  </script>
</body>
</html>
